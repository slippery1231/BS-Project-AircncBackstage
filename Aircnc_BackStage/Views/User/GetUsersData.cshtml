@{Layout = "_GetUsersDataLayout.cshtml";}

<!-- Begin Page Content -->
<div id="app">
    <div class="my-2">
        <div class="row">
            <div class="col-10">
                <b-form-group label="關鍵字搜尋" label-for="filter-input" label-cols-sm="3" label-align-sm="right"
                              label-size="sm" class="mb-0">
                    <b-input-group size="sm">
                        <b-form-input id="filter-input" v-model="filter" type="search" placeholder="請輸入關鍵字">
                        </b-form-input>

                        <b-input-group-append>
                            <b-button :disabled="!filter" v-on:click="filter = ''">Clear</b-button>
                        </b-input-group-append>
                    </b-input-group>
                </b-form-group>

            </div>

        </div>
    </div>
    <div class="card mb-4">
        <b-table striped hover id="table" :fields="fields" :items="userList"
                 label-sort-asc="" label-sort-desc="" label-sort-clear=""
                 :per-page="perPage" :current-page="currentPage"
                 :filter="filter" :filter-included-fields="filterOn" v-on:filtered="onFiltered">

            <!-- #cell()括弧內要放fields的key -->
            <template #cell(Detail)="row">
                <!-- 點開可以跳出內容 -->
                <b-button v-on:click="row.toggleDetails" class="detail-btn">詳細</b-button>
            </template>

            <!-- 可以自定義row -->
            <template #row-details="row">
                <b-card>
                    <ul>
                        <li v-for="(value,key) in row.item" :key="key">{{key}} : {{value}}</li>
                    </ul>
                </b-card>
            </template>
        </b-table>

        <!-- 分頁功能 -->
        <div class="mt-3">
            <b-pagination v-model="currentPage" :total-rows="rows" align="center" :per-page="perPage" aria-controls="table">
            </b-pagination>
        </div>
    </div>

</div>
<!-- End of Main Content -->

@section topCSS{
    <style>
        .detail-btn {
            background-color: #1cc88a
        }
    </style>

}


@section endJS{
    <script>
        let app = new Vue({
            el: '#app',
            data: {
                fields: [
                    { key: 'userId', label: '會員編號', sortable: true },
                    { key: 'name', label: '會員名稱' },
                    { key: 'email', label: '電子郵件' },
                    { key: 'createTime', label: '創建時間', sortable:true },
                    { key: 'Detail', label: '查看詳情' }
                ],
                userList: [],
                perPage: 5,
                currentPage: 1,
                filter: null,
                filterOn: [],

            },
            methods: {
                getUsers() {
                    fetch('/api/GetUserData/GetUsersData', {
                        headers: {
                            'Content-type': 'application/json',
                            'Authorization': GenCurrentAuthBarerFormat(),
                        },
                        method: 'Get',
                    })
                        .then(response => response.json())
                        .then(jsondata => {
                            console.log(jsondata)
                            this.userList = jsondata
                        })
                },
                onFiltered(filteredItems) {
                    // Trigger pagination to update the number of buttons/pages due to filtering
                    this.totalRows = filteredItems.length
                    this.currentPage = 1
                },
            },
            created() {
                this.getUsers()
            },
            computed: {
                rows() {
                    return this.userList.length
                }
            }
            
        })

    </script>

}